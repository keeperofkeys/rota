{% extends "base.html" %}

{% block body %}

<h2>{{ monthname }} {{ year }}</h2>

<script>
    DATA = [];
    CONTROLLERS = [];
    function DayController(date) {
        this.date = date;
        this.chunks = DATA[this.date];
        this.$cell = $('#c-'+this.date);
    }
    DayController.prototype.render = function() {
        for (var j=0; j<this.chunks.length; j++) {
            var chunk = this.chunks[j];
            this.$cell.append(chunk.user);
            this.$cell.append(chunk.text);
        }
    };

</script>

<table>
    <tr class="head">
        <th>Mon</th>
        <th>Tue</th>
        <th>Wed</th>
        <th>Thur</th>
        <th>Fri</th>
        <th>Sat</th>
        <th>Sun</th>
    {% for day in days %}
        {% if forloop.counter0|divisibleby:7 %}
    </tr>
    <tr class="dates">
        {% endif %}
        {% if day %}
        <td id="c-{{ day.date }}">
            <span class="date">{{ day.date }}</span>
            <script>
                DATA[Number({{ day.date }})] = [
                {% for chunk in day.chunks %}
                    {
                        id: {{ chunk.id }},
                        startTime: new Date("{{ chunk.start_time|date:'Y/m/d H:m' }}"),
                        endTime: new Date("{{ chunk.end_time|date:'Y/m/d H:m' }}"),
                        user: "{{ chunk.user.first_name }}",
                        text: "{{ chunk.text }}",
                        created: new Date("{{ chunk.created|date:'Y/m/d H:m' }}"),
                        lastChanged: new Date("{{ chunk.last_changed|date:'Y/m/d H:m' }}")
                    }
                {% endfor %}
                ];
                CONTROLLERS[Number({{ day.date }})] = new DayController(Number({{ day.date }}));
            </script>
        </td>
        {% else %}
        <td class="blank">
        </td>
        {% endif %}
    {% endfor %}
    </tr>

</table>

<nav><a href="{% url 'month' prev.0 prev.1 %}">&lt;prev</a> | <a href="{% url 'month' next.0 next.1 %}">next&gt;</a></nav>

<script>
    for (var j=1; j<CONTROLLERS.length + 1; j++) {
        CONTROLLERS[j].render();
    }
</script>


{% endblock %}